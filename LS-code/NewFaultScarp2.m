function NewFaultScarp2(varargin)% GUI to calculate times since faulting, using a diffusion model.  Can% compare calculated scarp profiles with measured data.switch nargin	case 0  % if no argument: initialize everything% Main windowa = figure('Color',[0.8 0.8 0.8], ...	'Name','Fault Scarp Model', ...	'Position',[0 0 1300 1000], ...	'Tag','Fig1', ...	'NumberTitle','off',...	'PaperPositionMode','auto');% Set up Kappa edit windowdata.MyHandles.Kappa_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[1 0.8 0.8], ...	'Callback','NewFaultScarp2(''SetKappa'')', ...    'FontSize',16, ...    'Position',[.235 .63 .08 .04], ...	'String','1.0e-5', ...	'Style','edit', ...	'Tag','SetKappa', ...	'Value',1.e-4);% Set up Kappa edit window labeldata.MyHandles.Kappa_label = annotation('textbox', ...    'String',' {\kappa}, m^{2} s^{-2}', ...    'FontSize',14, ...    'FontName','Helvetica', ...    'FontWeight','Normal', ...    'Position', [.250 0.59 .1 .035], ...    'Interpreter','Tex', ...    'EdgeColor','None');% Set up Add Segment buttondata.MyHandles.Add_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'Callback','NewFaultScarp2(''AddSegment'')', ...	'Enable','On', ...    'FontSize',12, ...	'Position',[.235 .850 .110 .060], ...	'String','Add Segment to IC', ...    'Style','pushbutton', ...	'Tag','AddSegment');% Set up Delete Segment buttondata.MyHandles.Delete_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'Callback','NewFaultScarp2(''DeleteSegment'')', ...	'Enable','On', ...    'FontSize',12, ...	'Position',[.235 .770 .110 .060], ...	'String','Delete Segment from IC', ...    'Style','pushbutton', ...	'Tag','DeleteSegment');% Set up Run buttondata.MyHandles.Run_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'Callback','NewFaultScarp2(''Run'')', ...	'Enable','On', ...    'FontSize', 18, ...    'ForegroundColor', 'red', ....	'Position',[.5 .350 .110 .060], ...	'String','RUN', ...    'Style','pushbutton', ...	'Tag','Run');% Set up IC graphdata.MyHandles.IC_Handle = axes('Parent',a, ...	'Units','normalized', ...	'Box','on', ...      'ButtonDownFcn',@ClickDrag_Callback, ...	'CameraUpVector',[0 1 0], ...	'CameraUpVectorMode','manual', ...	'Color',[1 1 1], ...    'FontName','Geneva', ...5    'HandleVisibility','Callback', ...    'Position',[0.4 .55 0.51 0.4 ], ...	'Tag','IC_Axes', ...	'XColor',[0 0 0], ...	'YColor',[0 0 0], ...	'ZColor',[0 0 0]);%colors  = ['k','c','m','g','r','b']% Set up Label for times to plotb = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...	'HorizontalAlignment','Center', ...	'Position',[.225 .52 .100 .035], ...	'String', 'Times to plot (yrs)', ...	'Style','text', ...    'FontSize',14, ...	'Tag','TimesLabel', ...	'Value',1);% Set up Time1 edit window%    'ForegroundColor',color(1,:), ...data.MyHandles.Time1_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'Callback','NewFaultScarp2(''SetTime1'')', ...    'FontSize',14, ...    'ForegroundColor','c', ...	'HorizontalAlignment','Center', ...	'Position',[.235 .345 .080 .040], ...	'String', '1000', ...	'Style','edit', ...	'Tag','Time1', ...	'Value',1);% Set up Time 2 edit windowdata.MyHandles.Time2_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'Callback','NewFaultScarp2(''SetTime2'')', ...    'FontSize',14, ...     'ForegroundColor','m', ...	'HorizontalAlignment','Center', ...	'Position',[.235 .380 .080 .040], ...	'String', '2000', ...	'Style','edit', ...	'Tag','Time2', ...	'Value',1);% Set up Time 3 edit windowdata.MyHandles.Time3_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'Callback','NewFaultScarp2(''SetTime3'')', ...    'FontSize',14, ...     'ForegroundColor','g', ...	'HorizontalAlignment','Center', ...	'Position',[.235 .415 .080 .040], ...	'String', '3000', ...	'Style','edit', ...	'Tag','Time3', ...	'Value',1);% Set up Time4 edit windowdata.MyHandles.Time4_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'Callback','NewFaultScarp2(''SetTime4'')', ....    'FontSize',14, ...     'ForegroundColor','r', ...	'HorizontalAlignment','Center', ...	'Position',[.235 .450 .080 .040], ...	'String', '4000', ...	'Style','edit', ...	'Tag','Time4', ...	'Value',1);% Set up Time5 (max time) edit windowdata.MyHandles.Time5_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'Callback','NewFaultScarp2(''SetTime5'')', ....    'FontSize',14, ...    'ForegroundColor','b', ...	'HorizontalAlignment','Center', ...	'Position',[.235 .485 .080 .040], ...	'String', '5000', ...	'Style','edit', ...	'Tag','Time5', ...	'Value',1);%Set up label for Data Table% c = uicontrol('Parent',a, ...%     'Units','normalized', ...% 	'BackgroundColor',[0.8 0.8 0.8], ...% 	'HorizontalAlignment','Center', ...% 	'Position',[.095 .950 .1 .030], ...% 	'String', 'X and Y data', ...% 	'Style','text', ...% 	'Tag','TableLabel', ...% 	'Value',1);% Set up Data Table% data.MyHandles.Data_Table_Handle = uitable('Parent',a, ...%     'Units','normalized',....%     'CellEditCallback',{@TableEdit}, ...%     'ColumnEditable',logical([1 1]), ...%     'ColumnName',{'x(m)' 'y(m)'}, ...%     'Data',zeros(35,2), ....%     'Position', [.05 .35 .16 .6], ...%     'Tag','DataTable');% Set up Xmin edit titledata.MyHandles.Xmax__label_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'FontName','Geneva', ....    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.38 .48 .05 .025], ...	'String', 'x_min', ...	'Style','text', ...	'Tag','XMinLabel', ...	'Value',1);% Set up Xmin edit windowdata.MyHandles.Xmin_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 1 0.8], ...     'Callback','NewFaultScarp2(''SetXMin'')', ....	'HorizontalAlignment','Center', ...    'FontSize',14, ...	'Position',[.38 .5 .04 .03], ...	'String',[ '0'], ...	'Style','edit', ...	'Tag','XMin', ...	'Value',1);% Set up Xmax edit titledata.MyHandles.Xmax_label_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.88 .48 .05 .025], ...	'String', 'x_max', ...	'Style','text', ...	'Tag','XMaxLabel', ...	'Value',1);% Set up Xmax edit windowdata.MyHandles.Xmax_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 1 0.8], ...    'Callback','NewFaultScarp2(''SetXMax'')', ....    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.88 .5 .04 .03], ...	'String', '10', ...	'Style','edit', ...	'Tag','XMax', ...	'Value',1);% Set up ymin edit titledata.MyHandles.ymax__label_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.795 0.8], ...    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.325 .528 .050 .025], ...	'String', 'y_min', ...	'Style','text', ...	'Tag','YMinLabel', ...	'Value',1);% Set up Ymin edit windowdata.MyHandles.Ymin_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 1 0.8], ...    'Callback','NewFaultScarp2(''SetYMin'')', ....    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.325 .55 .04 .03], ...	'String', '0', ...	'Style','edit', ...	'Tag','YMin', ...	'Value',1);% Set up Ymax edit titledata.MyHandles.Ymax_label_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 0.8 0.8], ...    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.325 .913 .050 .025], ...	'String', 'y_max', ...	'Style','text', ...	'Tag','YMaxLabel', ...	'Value',1);% Set up Ymax edit windowdata.MyHandles.Ymax_Handle = uicontrol('Parent',a, ...	'Units','normalized', ...	'BackgroundColor',[0.8 1 0.8], ...    'Callback','NewFaultScarp2(''SetYMax'')', ....    'FontSize',14, ...	'HorizontalAlignment','Center', ...	'Position',[.325 .935 .04 .03], ...	'String', '3', ...	'Style','edit', ...	'Tag','YMax', ...	'Value',1);% Set up FaultScarp File menu itemb = uimenu('Parent',a, ...	'Callback','NewFaultScarp2(''File_Menu'')', ...	'Label','Fault Scarp File', ...	'Tag','File_Menu');% Set up Open Model File menu itemc = uimenu('Parent',b, ...	'Callback','NewFaultScarp2(''Open_ModelFile'')', ...	'Label','Open Model File', ...5	'Tag','Open_ModelFile');% Set up Save Model menu itemc = uimenu('Parent',b, ...	'Callback','NewFaultScarp2(''Save_Model'')', ...	'Label','Save Model', ...	'Tag','Save_Model');% Set up Open Field Data menu itemc = uimenu('Parent',b, ...	'Callback','NewFaultScarp2(''Open_FieldData'')', ...    'Separator','on', ...	'Label','Plot Field Data', ...	'Tag','Open_FieldData');% Set up Erase Field Data menu itemc = uimenu('Parent',b, ...	'Callback','NewFaultScarp2(''UnPlot_FieldData'')', ...	'Label', 'Erase Field Data', ...	'Tag','Unplot_FieldData');% Set up Print menu item% c = uimenu('Parent',b, ...% 	'Callback','NewFaultScarp2(''Print'')', ...% 	'Label','Print', ...% 	'Separator','on',...% 	'Tag','Print');% Set up Quit menu itemc = uimenu('Parent',b, ...	'Callback','NewFaultScarp2(''Quit'')', ...	'Label','Quit', ...	'Separator','on', ...	'Tag','Quit');%---------------------% Here's what actually does the calculationsset(gcf,'UserData',data);initialize_fault_scarp;   % initializes data structure%initialize IC plot -- first cut  plotICcolors  = get(gca,'ColorOrder');data.colors = colors;set(data.MyHandles.Time1_Handle,'ForegroundColor', data.colors(2,:))set(data.MyHandles.Time2_Handle,'ForegroundColor', data.colors(3,:))set(data.MyHandles.Time3_Handle,'ForegroundColor', data.colors(4,:))set(data.MyHandles.Time4_Handle,'ForegroundColor', data.colors(5,:))set(data.MyHandles.Time5_Handle,'ForegroundColor', data.colors(6,:))set(gcf,'UserData',data);otherwisechoice = varargin{1}; % if there's a callbackdata=get(gcf,'UserData');switch choice;	case ''		initialize_fault_scarp;		checkbuttons	case 'AddSegment'		Add_Callback		checkbuttons	case 'DeleteSegment'		Delete_Callback		checkbuttons	case 'SetKappa'		SetKappa;	case 'ClickDrag'        ClickDrag_Callback	case 'Run'		SolveDiffEq;	case 'SetXMin'	            SetXMin;    case 'SetXMax'	            SetXMax;    case 'SetYMin'            SetYMin;    case 'SetYMax'            SetYMax    case 'SetTime1'            SetTime(1)    case 'SetTime2'            SetTime(2)    case 'SetTime3'            SetTime(3)    case 'SetTime4'            SetTime(4)    case 'SetTime5'            SetTime(5)    case 'File_Menu'            FileMenu_Callback    case 'Open_ModelFile'            Open_ModelFile_Callback    case 'Open_FieldData'            Open_FieldData_Callback            PlotData    case 'UnPlot_FieldData'            ClearFieldData    case 'Save_Model'            Save_ModelFile_Callback	case 'Print'		Print_Submenu_Callback	case 'Quit'		close	otherwise		disp('error in callbacks')endend